-- WARNING: This schema is for context only and is not meant to be run.
-- Table order and constraints may not be valid for execution.

CREATE TABLE public.accounts (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  code character varying NOT NULL UNIQUE,
  name character varying NOT NULL,
  qbo_customer_id character varying,
  active boolean NOT NULL DEFAULT true,
  created_at timestamp without time zone NOT NULL DEFAULT now(),
  updated_at timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT accounts_pkey PRIMARY KEY (id)
);
CREATE TABLE public.addresses (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  account_id uuid NOT NULL,
  type character varying NOT NULL,
  line1 character varying NOT NULL,
  line2 character varying,
  city character varying NOT NULL,
  state character varying NOT NULL,
  postal_code character varying NOT NULL,
  country character varying NOT NULL DEFAULT 'US'::character varying,
  is_primary boolean NOT NULL DEFAULT false,
  created_at timestamp without time zone NOT NULL DEFAULT now(),
  updated_at timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT addresses_pkey PRIMARY KEY (id),
  CONSTRAINT addresses_account_id_accounts_id_fk FOREIGN KEY (account_id) REFERENCES public.accounts(id)
);
CREATE TABLE public.audit_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  entity_type character varying NOT NULL,
  entity_id uuid NOT NULL,
  action character varying NOT NULL,
  user_id character varying NOT NULL,
  changes jsonb,
  timestamp timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT audit_logs_pkey PRIMARY KEY (id)
);
CREATE TABLE public.contacts (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  account_id uuid NOT NULL,
  name character varying NOT NULL,
  email character varying NOT NULL,
  phone character varying,
  is_primary boolean NOT NULL DEFAULT false,
  created_at timestamp without time zone NOT NULL DEFAULT now(),
  updated_at timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT contacts_pkey PRIMARY KEY (id),
  CONSTRAINT contacts_account_id_accounts_id_fk FOREIGN KEY (account_id) REFERENCES public.accounts(id)
);
CREATE TABLE public.documents (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  organization_id uuid,
  filename character varying NOT NULL,
  file_url text NOT NULL,
  file_size bigint,
  mime_type character varying,
  document_type character varying,
  category character varying,
  tags ARRAY,
  entity_type character varying,
  entity_id uuid,
  description text,
  version integer DEFAULT 1,
  is_public boolean DEFAULT false,
  uploaded_by character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT documents_pkey PRIMARY KEY (id),
  CONSTRAINT documents_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.email_activity_log (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  email_queue_id uuid,
  activity_type character varying NOT NULL,
  recipient_email character varying,
  ip_address inet,
  user_agent text,
  link_clicked text,
  metadata jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT email_activity_log_pkey PRIMARY KEY (id),
  CONSTRAINT email_activity_log_email_queue_id_fkey FOREIGN KEY (email_queue_id) REFERENCES public.email_queue(id)
);
CREATE TABLE public.email_logs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  template_id uuid,
  to text NOT NULL,
  cc text,
  bcc text,
  subject character varying NOT NULL,
  body text NOT NULL,
  status character varying NOT NULL DEFAULT 'sent'::character varying,
  error text,
  sent_by character varying NOT NULL,
  related_entity_type character varying,
  related_entity_id uuid,
  sent_at timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT email_logs_pkey PRIMARY KEY (id),
  CONSTRAINT email_logs_template_id_email_templates_id_fk FOREIGN KEY (template_id) REFERENCES public.email_templates(id)
);
CREATE TABLE public.email_queue (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  organization_id uuid,
  template_id uuid,
  to_addresses ARRAY NOT NULL,
  cc_addresses ARRAY,
  bcc_addresses ARRAY,
  subject character varying NOT NULL,
  body_html text NOT NULL,
  body_text text,
  attachments jsonb,
  entity_type character varying,
  entity_id uuid,
  status character varying DEFAULT 'pending'::character varying,
  priority integer DEFAULT 5,
  scheduled_send_at timestamp with time zone,
  sent_at timestamp with time zone,
  error_message text,
  retry_count integer DEFAULT 0,
  provider character varying,
  message_id character varying,
  created_by character varying,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT email_queue_pkey PRIMARY KEY (id),
  CONSTRAINT email_queue_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id),
  CONSTRAINT email_queue_template_id_fkey FOREIGN KEY (template_id) REFERENCES public.email_templates(id)
);
CREATE TABLE public.email_templates (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  organization_id uuid,
  name character varying NOT NULL,
  subject character varying NOT NULL,
  body_html text NOT NULL,
  body_text text,
  template_type character varying,
  variables jsonb,
  active boolean DEFAULT true,
  created_by character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT email_templates_pkey PRIMARY KEY (id),
  CONSTRAINT email_templates_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.entity_sync_map (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  organization_id uuid,
  entity_type character varying NOT NULL,
  entity_id uuid NOT NULL,
  qbo_entity_type character varying NOT NULL,
  qbo_entity_id character varying NOT NULL,
  qbo_sync_token character varying,
  last_synced_at timestamp with time zone,
  sync_status character varying DEFAULT 'synced'::character varying,
  last_error text,
  local_updated_at timestamp with time zone,
  qbo_updated_at timestamp with time zone,
  conflict_resolution character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT entity_sync_map_pkey PRIMARY KEY (id),
  CONSTRAINT entity_sync_map_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.invoice_lines (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  invoice_id uuid,
  order_line_id uuid,
  line_number integer NOT NULL,
  product_id uuid,
  product_sku character varying,
  description text NOT NULL,
  quantity numeric NOT NULL,
  unit_of_measure character varying,
  unit_price numeric NOT NULL,
  discount_amount numeric DEFAULT 0,
  tax_rate numeric DEFAULT 0,
  tax_amount numeric DEFAULT 0,
  line_total numeric NOT NULL,
  qbo_line_id character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT invoice_lines_pkey PRIMARY KEY (id),
  CONSTRAINT invoice_lines_invoice_id_fkey FOREIGN KEY (invoice_id) REFERENCES public.invoices(id)
);
CREATE TABLE public.invoices (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  organization_id uuid,
  invoice_number character varying NOT NULL UNIQUE,
  invoice_type character varying DEFAULT 'standard'::character varying,
  invoice_status character varying DEFAULT 'draft'::character varying,
  order_id uuid,
  customer_id uuid,
  billing_address_id uuid,
  invoice_date date NOT NULL DEFAULT CURRENT_DATE,
  due_date date NOT NULL,
  service_period_start date,
  service_period_end date,
  currency character varying DEFAULT 'USD'::character varying,
  exchange_rate numeric DEFAULT 1,
  subtotal numeric DEFAULT 0,
  discount_amount numeric DEFAULT 0,
  tax_amount numeric DEFAULT 0,
  shipping_cost numeric DEFAULT 0,
  total_amount numeric NOT NULL,
  amount_paid numeric DEFAULT 0,
  balance_due numeric,
  payment_terms character varying,
  payment_method character varying,
  po_number character varying,
  notes text,
  terms_and_conditions text,
  email_sent boolean DEFAULT false,
  email_sent_at timestamp with time zone,
  email_viewed boolean DEFAULT false,
  email_viewed_at timestamp with time zone,
  qbo_invoice_id character varying,
  qbo_doc_number character varying,
  qbo_sync_token character varying,
  qbo_last_synced_at timestamp with time zone,
  pdf_url text,
  pdf_generated_at timestamp with time zone,
  created_by character varying,
  approved_by character varying,
  approved_at timestamp with time zone,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT invoices_pkey PRIMARY KEY (id),
  CONSTRAINT invoices_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.notifications (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  organization_id uuid,
  user_id character varying,
  title character varying NOT NULL,
  message text NOT NULL,
  notification_type character varying NOT NULL,
  category character varying,
  entity_type character varying,
  entity_id uuid,
  entity_url text,
  is_read boolean DEFAULT false,
  read_at timestamp with time zone,
  send_email boolean DEFAULT false,
  email_sent boolean DEFAULT false,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT notifications_pkey PRIMARY KEY (id),
  CONSTRAINT notifications_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.order_lines (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  order_id uuid NOT NULL,
  line_no integer NOT NULL,
  product_id uuid NOT NULL,
  size_grade character varying,
  quantity numeric NOT NULL,
  unit_size numeric NOT NULL,
  uom character varying NOT NULL,
  total_weight numeric NOT NULL,
  unit_price numeric NOT NULL,
  commission_pct numeric,
  commission_amt numeric,
  line_total numeric NOT NULL,
  created_at timestamp without time zone NOT NULL DEFAULT now(),
  updated_at timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT order_lines_pkey PRIMARY KEY (id),
  CONSTRAINT order_lines_order_id_orders_id_fk FOREIGN KEY (order_id) REFERENCES public.orders(id),
  CONSTRAINT order_lines_product_id_products_id_fk FOREIGN KEY (product_id) REFERENCES public.products(id)
);
CREATE TABLE public.order_status_history (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  order_id uuid,
  from_status character varying,
  to_status character varying NOT NULL,
  changed_by character varying,
  notes text,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT order_status_history_pkey PRIMARY KEY (id)
);
CREATE TABLE public.orders (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  order_no character varying NOT NULL UNIQUE,
  seller_id uuid NOT NULL,
  buyer_id uuid NOT NULL,
  status character varying NOT NULL DEFAULT 'draft'::character varying,
  contract_no character varying,
  qbo_doc_type character varying,
  qbo_doc_id character varying,
  qbo_doc_number character varying,
  subtotal numeric NOT NULL DEFAULT '0'::numeric,
  commission_total numeric NOT NULL DEFAULT '0'::numeric,
  total_amount numeric NOT NULL DEFAULT '0'::numeric,
  terms text,
  notes text,
  pallet_count integer,
  created_by character varying NOT NULL,
  created_at timestamp without time zone NOT NULL DEFAULT now(),
  updated_at timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT orders_pkey PRIMARY KEY (id),
  CONSTRAINT orders_seller_id_accounts_id_fk FOREIGN KEY (seller_id) REFERENCES public.accounts(id),
  CONSTRAINT orders_buyer_id_accounts_id_fk FOREIGN KEY (buyer_id) REFERENCES public.accounts(id)
);
CREATE TABLE public.organizations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL,
  legal_name character varying NOT NULL,
  tax_id character varying,
  phone character varying,
  email character varying,
  website character varying,
  logo_url text,
  timezone character varying DEFAULT 'America/New_York'::character varying,
  currency character varying DEFAULT 'USD'::character varying,
  date_format character varying DEFAULT 'MM/DD/YYYY'::character varying,
  fiscal_year_start integer DEFAULT 1,
  active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT organizations_pkey PRIMARY KEY (id)
);
CREATE TABLE public.outlook_tokens (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id character varying NOT NULL UNIQUE,
  access_token text NOT NULL,
  refresh_token text NOT NULL,
  expires_at timestamp without time zone NOT NULL,
  email character varying NOT NULL,
  created_at timestamp without time zone NOT NULL DEFAULT now(),
  updated_at timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT outlook_tokens_pkey PRIMARY KEY (id)
);
CREATE TABLE public.payment_applications (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  payment_id uuid,
  invoice_id uuid,
  amount_applied numeric NOT NULL,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT payment_applications_pkey PRIMARY KEY (id),
  CONSTRAINT payment_applications_payment_id_fkey FOREIGN KEY (payment_id) REFERENCES public.payments(id),
  CONSTRAINT payment_applications_invoice_id_fkey FOREIGN KEY (invoice_id) REFERENCES public.invoices(id)
);
CREATE TABLE public.payments (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  organization_id uuid,
  payment_number character varying NOT NULL UNIQUE,
  customer_id uuid,
  payment_date date NOT NULL DEFAULT CURRENT_DATE,
  payment_method character varying NOT NULL,
  reference_number character varying,
  amount numeric NOT NULL,
  currency character varying DEFAULT 'USD'::character varying,
  deposit_to_account character varying,
  bank_account_id character varying,
  payment_status character varying DEFAULT 'pending'::character varying,
  cleared_date date,
  qbo_payment_id character varying,
  qbo_sync_token character varying,
  qbo_last_synced_at timestamp with time zone,
  notes text,
  created_by character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT payments_pkey PRIMARY KEY (id),
  CONSTRAINT payments_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.pdfs (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  order_id uuid NOT NULL,
  type character varying NOT NULL,
  url text NOT NULL,
  version integer NOT NULL DEFAULT 1,
  created_at timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT pdfs_pkey PRIMARY KEY (id),
  CONSTRAINT pdfs_order_id_orders_id_fk FOREIGN KEY (order_id) REFERENCES public.orders(id)
);
CREATE TABLE public.permissions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  module text NOT NULL,
  action text NOT NULL,
  description text,
  created_at timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT permissions_pkey PRIMARY KEY (id)
);
CREATE TABLE public.product_categories (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  organization_id uuid,
  name character varying NOT NULL,
  parent_id uuid,
  description text,
  sort_order integer DEFAULT 0,
  active boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT product_categories_pkey PRIMARY KEY (id),
  CONSTRAINT product_categories_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id),
  CONSTRAINT product_categories_parent_id_fkey FOREIGN KEY (parent_id) REFERENCES public.product_categories(id)
);
CREATE TABLE public.products (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name character varying NOT NULL,
  variety character varying,
  grade character varying,
  default_unit_size numeric,
  uom character varying NOT NULL,
  qbo_item_id character varying,
  active boolean NOT NULL DEFAULT true,
  created_at timestamp without time zone NOT NULL DEFAULT now(),
  updated_at timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT products_pkey PRIMARY KEY (id)
);
CREATE TABLE public.quickbooks_connections (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  organization_id uuid,
  realm_id character varying NOT NULL,
  company_name character varying,
  access_token text NOT NULL,
  refresh_token text NOT NULL,
  token_expires_at timestamp with time zone,
  environment character varying DEFAULT 'sandbox'::character varying,
  base_url text,
  connected_at timestamp with time zone DEFAULT now(),
  last_sync_at timestamp with time zone,
  is_active boolean DEFAULT true,
  connection_status character varying DEFAULT 'connected'::character varying,
  error_message text,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT quickbooks_connections_pkey PRIMARY KEY (id),
  CONSTRAINT quickbooks_connections_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.quickbooks_webhooks (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  organization_id uuid,
  realm_id character varying NOT NULL,
  event_id character varying NOT NULL UNIQUE,
  entity_name character varying NOT NULL,
  operation character varying NOT NULL,
  qbo_entity_id character varying NOT NULL,
  payload jsonb NOT NULL,
  processed boolean DEFAULT false,
  processed_at timestamp with time zone,
  processing_error text,
  received_at timestamp with time zone DEFAULT now(),
  CONSTRAINT quickbooks_webhooks_pkey PRIMARY KEY (id),
  CONSTRAINT quickbooks_webhooks_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.role_permissions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  role_id uuid NOT NULL,
  permission_id uuid NOT NULL,
  created_at timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT role_permissions_pkey PRIMARY KEY (id),
  CONSTRAINT role_permissions_role_id_roles_id_fk FOREIGN KEY (role_id) REFERENCES public.roles(id),
  CONSTRAINT role_permissions_permission_id_permissions_id_fk FOREIGN KEY (permission_id) REFERENCES public.permissions(id)
);
CREATE TABLE public.roles (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  name text NOT NULL UNIQUE,
  description text,
  is_active boolean NOT NULL DEFAULT true,
  created_at timestamp without time zone NOT NULL DEFAULT now(),
  updated_at timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT roles_pkey PRIMARY KEY (id)
);
CREATE TABLE public.sync_history (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  organization_id uuid,
  sync_type character varying NOT NULL,
  entity_type character varying,
  direction character varying NOT NULL,
  status character varying NOT NULL,
  records_processed integer DEFAULT 0,
  records_succeeded integer DEFAULT 0,
  records_failed integer DEFAULT 0,
  started_at timestamp with time zone DEFAULT now(),
  completed_at timestamp with time zone,
  error_summary text,
  error_details jsonb,
  triggered_by character varying,
  CONSTRAINT sync_history_pkey PRIMARY KEY (id),
  CONSTRAINT sync_history_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.sync_maps (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  entity_type character varying NOT NULL,
  entity_id uuid NOT NULL,
  qbo_type character varying NOT NULL,
  qbo_id character varying NOT NULL,
  sync_metadata jsonb,
  last_synced_at timestamp without time zone NOT NULL DEFAULT now(),
  created_at timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT sync_maps_pkey PRIMARY KEY (id)
);
CREATE TABLE public.system_settings (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  organization_id uuid,
  setting_key character varying NOT NULL,
  setting_value text,
  data_type character varying DEFAULT 'string'::character varying,
  category character varying,
  description text,
  is_encrypted boolean DEFAULT false,
  updated_by character varying,
  created_at timestamp with time zone DEFAULT now(),
  updated_at timestamp with time zone DEFAULT now(),
  CONSTRAINT system_settings_pkey PRIMARY KEY (id),
  CONSTRAINT system_settings_organization_id_fkey FOREIGN KEY (organization_id) REFERENCES public.organizations(id)
);
CREATE TABLE public.user_activity_log (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id character varying,
  action character varying NOT NULL,
  entity_type character varying,
  entity_id uuid,
  ip_address inet,
  user_agent text,
  metadata jsonb,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT user_activity_log_pkey PRIMARY KEY (id)
);
CREATE TABLE public.user_invitations (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  email character varying NOT NULL,
  role character varying NOT NULL,
  invited_by character varying NOT NULL,
  token character varying NOT NULL UNIQUE,
  status character varying NOT NULL DEFAULT 'pending'::character varying,
  expires_at timestamp without time zone NOT NULL,
  accepted_at timestamp without time zone,
  resent_at timestamp without time zone,
  resent_count character varying NOT NULL DEFAULT '0'::character varying,
  created_at timestamp without time zone NOT NULL DEFAULT now(),
  updated_at timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT user_invitations_pkey PRIMARY KEY (id)
);
CREATE TABLE public.user_permissions (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  user_id character varying,
  resource character varying NOT NULL,
  action character varying NOT NULL,
  allowed boolean DEFAULT true,
  created_at timestamp with time zone DEFAULT now(),
  CONSTRAINT user_permissions_pkey PRIMARY KEY (id)
);
CREATE TABLE public.user_roles (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  clerk_user_id text NOT NULL UNIQUE,
  role_id uuid NOT NULL,
  created_at timestamp without time zone NOT NULL DEFAULT now(),
  updated_at timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT user_roles_pkey PRIMARY KEY (id),
  CONSTRAINT user_roles_role_id_roles_id_fk FOREIGN KEY (role_id) REFERENCES public.roles(id)
);
CREATE TABLE public.users (
  id character varying NOT NULL,
  email character varying NOT NULL UNIQUE,
  first_name character varying,
  last_name character varying,
  role character varying NOT NULL DEFAULT 'agent'::character varying,
  active boolean NOT NULL DEFAULT true,
  created_at timestamp without time zone NOT NULL DEFAULT now(),
  updated_at timestamp without time zone NOT NULL DEFAULT now(),
  mfa_enabled boolean NOT NULL DEFAULT false,
  mfa_secret character varying,
  mfa_backup_codes text,
  last_login_at timestamp without time zone,
  CONSTRAINT users_pkey PRIMARY KEY (id)
);
CREATE TABLE public.webhook_events (
  id uuid NOT NULL DEFAULT gen_random_uuid(),
  event_id character varying NOT NULL UNIQUE,
  realm_id character varying NOT NULL,
  entity_name character varying NOT NULL,
  operation character varying NOT NULL,
  entity_id character varying NOT NULL,
  payload jsonb NOT NULL,
  processed character varying NOT NULL DEFAULT 'pending'::character varying,
  processed_at timestamp without time zone,
  error_message text,
  created_at timestamp without time zone NOT NULL DEFAULT now(),
  CONSTRAINT webhook_events_pkey PRIMARY KEY (id)
);